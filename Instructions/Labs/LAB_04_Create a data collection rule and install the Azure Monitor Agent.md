---
lab:
  title: 演習 04 - データ収集ルールを作成して Azure Monitor エージェントをインストールする
  module: Module 05 - Collect guest operating system monitoring data from Azure and hybrid virtual machines using Azure Monitor Agent
---


>**注**: このラボを完了するには、管理者アクセス権のある [Azure サブスクリプション](https://azure.microsoft.com/en-us/free/?azure-portal=true) が必要です。 


データ収集ルール (DCR) では収集するデータを指定しますが、Azure Monitor エージェントはこれらのルールを適用して、Azure、他のクラウド、またはオンプレミスの仮想マシンからログとメトリックを収集します。 これらを組み合わせることで、さまざまな環境で一貫性のある一元的な監視が可能になります。

---

## スキル タスク

- データ収集ルールを作成して定義します。

- データ収集のターゲット リソースを選択します。

- Azure Monitor エージェントをインストールします。
  
- データ ソースと収集先を構成します。

- 収集するデータ ソースの種類とデータを選択します。

- データ配信先を選択します。

## 演習の手順 

### データ収集ルールを作成および定義して Azure Monitor エージェントをインストールする

>**注**: Log Analytics ワークスペースまたは Azure Monitor ワークスペースと同じリージョンにデータ収集ルールを作成してください。 データ収集ルールは、テナント内の任意のサブスクリプションまたはリソース グループのマシンまたはコンテナーに関連付けることができます。 Azure Monitor エージェントは、Azure 仮想リソースに自動的にインストールされます。

1. ブラウザー セッションを開始し、[Azure portal メニュー](https://portal.azure.com/)にサインインします。
  
3. ポータルの上部にある検索ボックスに、「**データ収集ルール**」と入力します。 検索結果にある **[データ収集ルール]** を選択します。
  
4. **[データ収集ルール]** ページで、**[+ 作成]** を選択します。
  
    ![image](https://github.com/user-attachments/assets/a472bc6f-fa96-4615-a67c-c99e8b9ce7a4)

5. **[データ収集ルールの作成] ブレード**の **[基本]** ページで、次の設定を指定します (他の設定は既定値のままにします)。

    |設定|値|
    |---|---|
    |**ルールの詳細**|
    |規則の名前|**dcr-1**|
    |サブスクリプション|サブスクリプションを選択します。|
    |Resource group|**az-rg-1**|
    |リージョン|**米国東部**|
    |プラットフォームの種類|**Windows**|
    |データ収集エンドポイント|既定の設定の "なし" のままにします|

   ![image](https://github.com/user-attachments/assets/6c63c48f-f7a9-4fb2-8fc0-e22084cd5013)

6. **[基本]** ページの下部にある **[次へ: リソース]** というラベルの付いたボタンをクリックして次に進みます。
   
7. **[リソース]** ページで、**[+ リソースの追加]** を選択します。

   ![image](https://github.com/user-attachments/assets/7e45996b-478b-4be4-9df3-df6127da6cb4)

8. **[スコープの選択]** テンプレートで、**[スコープ]** の **[サブスクリプション]** ボックスをオンにします。

   ![image](https://github.com/user-attachments/assets/0d228e47-039e-4418-ae66-025957e368bc)

9. **[スコープの選択]** テンプレートの下部にある **[適用]** をクリックします。
  
10. **[リソース]** ページの下部にある **[次へ: 収集と配信]** を選択します。

    ![image](https://github.com/user-attachments/assets/95556211-654f-4810-98a0-5cd8fac13bff)  

11. **[収集と配信] ページ**で、**[+ データ ソースの追加]** をクリックします。

    ![image](https://github.com/user-attachments/assets/8274b0c1-8617-4889-9aef-78e050f2bd00)

12. **[データ ソースの追加]** テンプレートの **[データ ソースの種類]** で、次の設定を選択します。
    
    |設定|Value|
    |---|---|
    |**データ ソースの追加**|
    |リソースについて、収集するデータ ソースの種類とデータを選択します。|
    |データ ソースの種類*|**Windows イベント ログ**|
    |[基本] を選択してイベント ログの収集を有効にします。|
    |収集するイベント ログとレベルを構成します。|
    |アプリケーション|**重大**、**エラー**、**警告**|
    |セキュリティ|**監査の成功**、**監査の失敗**|
    |System|**重大**、**エラー**、**警告**|

    ![image](https://github.com/user-attachments/assets/33039994-0613-40f4-9c55-03f795b38b9b)

13. **[データ ソースの追加]** テンプレートの下部にある **[次へ: 宛先]** を選択します。

14. **[データ ソースの追加]** テンプレートの **[宛先]** タブで、次の設定を選択します。
    
    |設定|Value|
    |---|---|
    |**データ ソースの追加**|
    |宛先|**+ 宛先の追加**|
    |変換先の型|**Azure Monitor Logs**|
    |サブスクリプション|サブスクリプションを選択します。|
    |宛先の詳細|**azwrkspc1a (az-rg-1**)|

     ![image](https://github.com/user-attachments/assets/dc2d2906-4a57-4df9-a33c-fd6ae34a8457)

15. **[データ ソースの追加]** テンプレートの下部にある **[データ ソース の追加]** を選択します。

16. **[収集と配信]** ページの下部にある **[確認および作成]** を選択します。

    ![image](https://github.com/user-attachments/assets/4277089c-971c-4334-a49d-6ac6bfe93ff4)

17. **[確認および作成]** ページの下部にある **[作成]** を選択します。

    ![image](https://github.com/user-attachments/assets/b532f92e-af10-4b4d-bb52-10d15ad38d4a)

> **結果**: データ収集ルールが作成され、Azure Monitor エージェントがインストールされました。
